<div id="treeList" class="">

    @(Html.DevExtreme().DataGrid<ERPKeeperCore.Enterprise.Models.Employees.EmployeeDailyRecord>()
        .ID("gridList")
        .DataSource(d => d.RemoteController().Key("Id")
        .LoadUrl($"/API/HR/Employees/{EmployeeId}/EmployeeDailyRecords/All")
        .InsertUrl($"/API/HR/Employees/{EmployeeId}/EmployeeDailyRecords/Insert")
        .UpdateUrl($"/API/HR/Employees/{EmployeeId}/EmployeeDailyRecords/Update").UpdateMethod("Post")
        .DeleteUrl($"/API/HR/Employees/{EmployeeId}/EmployeeDailyRecords/Delete").DeleteMethod("Post")
        )
        .KeyExpr("Id")
        .AllowColumnReordering(true)
        .ShowRowLines(true)
        .ShowBorders(false)
        .Width("100%")
        .Paging(paging => paging.PageSize(100))
        .StateStoring(s => s.Enabled(true).Type(StateStoringType.SessionStorage).StorageKey("EmployeeDailyRecords"))
        .GroupPanel(gp => gp.Visible(true)) 
        .ColumnChooser(columnChooser => columnChooser.Enabled(true))    
        .AllowColumnResizing(true).AllowColumnReordering(true)
        .HeaderFilter(headerFilter => headerFilter.Visible(true).Search(s=>s.Enabled(true)))
        .FilterRow(filterRow => filterRow
        .Visible(true)
        .ApplyFilter(GridApplyFilterMode.Auto)
        )
        .ColumnAutoWidth(false)
        .RowDragging(rd => rd
        .AllowDropInsideItem(false)
        .AllowReordering(false)
        )
        .OnRowPrepared(@"function(e) { 
            if(e.rowType === 'data') {
                if(e.data.Type === 0) { 
                    e.rowElement.css('background-color', '#add8e6');
                } else if(e.data.Type === 3 || e.data.Type === 4) { 
                    e.rowElement.css('background-color', '#ffcccb');
                } else if(e.data.Type === 5) { 
                    e.rowElement.css('background-color', '#d3d3d3');
                }
            }
        }")
        .Columns(columns =>
        {
            columns.AddFor(m => m.RecordDate)
                .Width(130)
                .SortIndex(0)
                .SortOrder(SortOrder.Desc)
                .Format(Format.ShortDate)
                .HeaderCellTemplate(@<text>Date</text>);

            columns.AddFor(m => m.Type)
                .Width(150)
                .HeaderCellTemplate(@<text>Attendance Type</text>)
                .Lookup(lookup => lookup
                    .DataSource(Html.GetEnumSelectList<ERPKeeperCore.Enterprise.Models.Employees.AttendanceType>().Select(i => new { Value = int.Parse(i.Value), Text = i.Text }).ToList())
                    .DisplayExpr("Text")
                    .ValueExpr("Value")
                );

            columns.AddFor(m => m.Status)
                .Width(100)
                .HeaderCellTemplate(@<text>Status</text>)
                .Lookup(lookup => lookup
                    .DataSource(Html.GetEnumSelectList<ERPKeeperCore.Enterprise.Models.Employees.AttendanceStatus>().Select(i => new { Value = int.Parse(i.Value), Text = i.Text }).ToList())
                    .DisplayExpr("Text")
                    .ValueExpr("Value")
                );

            columns.AddFor(m => m.Notes)
                .Width(250)
                .HeaderCellTemplate(@<text>Notes</text>);
        })
        .Summary(s => s.TotalItems(items =>
        {
            items.Add()
                .Column("Type")
                .SummaryType(SummaryType.Count)
                .CustomizeText("function(data) { return 'Total Days: ' + data.value; }");
        }))
    )
</div>


